<!doctype html>
<html lang="en">

<head>
    <title>Feedback Submission</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">


    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- Axios -->
    <script src='https://unpkg.com/axios/dist/axios.min.js'></script>

</head>

<body>
    <div id="app" class="container">
        <h1>Feedback Form</h1>

        <div class="row">
            <div id="feedback_form" class="col-8">
                <h3>How was your experience?</h3>
                <form @submit.prevent="submitFeedback">
                    <!-- Order Info -->
                    <div class="form-group">
                        <label for="order_id">Order ID</label>
                        <input v-model="order_id" type="text" class="form-control" id="order_id" placeholder="Order ID" required>
                    </div>
                    <div class="form-group">
                        <label for="menu_item_id">Menu Item ID</label>
                        <input v-model="menu_item_id" type="text" class="form-control" id="menu_item_id" placeholder="Menu Item ID" required>
                    </div>

                    <!-- Rating -->
                    <div class="form-group">
                        <label for="rating">Rating</label>
                        <select v-model="rating" class="form-control" id="rating" required>
                            <option value="">Select Rating</option>
                            <option value="1">1 - Poor</option>
                            <option value="2">2 - Fair</option>
                            <option value="3">3 - Good</option>
                            <option value="4">4 - Very Good</option>
                            <option value="5">5 - Excellent</option>
                        </select>
                    </div>

                    <!-- Tags -->
                    <div class="form-group">
                        <label for="tags">Tags (comma separated)</label>
                        <input v-model="tags" type="text" class="form-control" id="tags" placeholder="Enter tags (e.g., spicy, vegan)">
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label for="description">Description</label>
                        <textarea v-model="description" class="form-control" id="description" rows="3" placeholder="Write your feedback here"></textarea>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary">Submit Feedback</button>
                </form>

                <!-- Success Message -->
                <div class="text-success" v-if="feedbackSubmitted">
                    Your feedback has been successfully submitted! <br>
                </div>
                <div class="text-danger" v-if="feedbackError">
                    There was an issue submitting your feedback: {{ feedbackError }}
                </div>
            </div>
        </div>
    </div>

    <script>
        const submit_feedback_URL = "http://localhost:5005/submit_feedback"; 

        const app = Vue.createApp({
            data() {
                return {
                    order_id: "",
                    menu_item_id: "",
                    rating: "",
                    tags: "",
                    description: "",
                    feedbackSubmitted: false,
                    feedbackError: ""
                    
                };
            },
            methods: {
                submitFeedback() {
                    this.feedbackSubmitted = false;
                    this.feedbackError = "";

                    const feedbackData = {
                        order_id: this.order_id,
                        menu_item_id: this.menu_item_id,
                        rating: this.rating,
                        tags: this.tags ? this.tags.split(',').map(tag => tag.trim()) : [],
                        description: this.description
                    };

                    axios.post(submit_feedback_URL, feedbackData)
                        .then(response => {
                            console.log(response.data);
                            if (response.data.code === 201) {
                                this.feedbackSubmitted = true;
                            } else {
                                this.feedbackError = response.data.message || "Unexpected error.";
                            }
                        })
                        .catch(error => {
                            console.error(error);
                            this.feedbackError = "There was an error submitting your feedback.";
                        });
                }
            }
        });

        const vm = app.mount('#app');
    </script>

    <!-- Bootstrap JS bundle to be placed before the closing </body> tag -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

</body>

</html>
