<body>
    <div id="app" class="container">
      <h1>Feedback Submission</h1>
  
      <!-- Display Menu Item Details -->
      <div v-if="menuItemName">
        <p><strong>Menu Item:</strong> {{ menuItemName }}</p>
        <p><strong>Description:</strong> {{ menuItemDescription }}</p>
        <p><strong>Price:</strong> ${{ menuItemPrice }}</p>
        <p><strong>Availability:</strong> {{ menuItemAvailability ? 'Available' : 'Out of Stock' }}</p>
      </div>
  
      <!-- Feedback Form -->
      <div v-if="!feedbackSubmitted">
        <label>Rating:
          <select v-model="rating">
            <option disabled value="">Select Rating</option>
            <option v-for="n in 5" :key="n">{{ n }}</option>
          </select>
        </label><br>
  
        <label>Tags (comma separated):
          <input type="text" v-model="tags" placeholder="e.g., spicy, vegan" />
        </label><br>
  
        <label>Description:
          <textarea v-model="description"></textarea>
        </label><br>
  
        <button @click="submitFeedback">Submit Feedback</button>
      </div>
  
      <!-- Success Message -->
      <div v-if="feedbackSubmitted" style="color: green; margin-top: 10px;">
        Feedback submitted successfully!
      </div>
  
      <!-- Error Message -->
      <div v-if="feedbackError" style="color: red; margin-top: 10px;">
        {{ feedbackError }}
      </div>
    </div>
  
    <!-- Vue & Axios -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  
    <script>
      const submit_feedback_URL = "http://localhost:5005/submit_feedback";
      const menu_service_URL = "http://localhost:5002/menu/item";
  
      const app = Vue.createApp({
        data() {
          return {
            customerID: "123", // Manual test value
            menuItemID: 1, // Manual test value, make sure it exists in your menu DB
            rating: "",
            tags: "",
            description: "",
            feedbackSubmitted: false,
            feedbackError: "",
            menuItemName: "",
            menuItemDescription: "",
            menuItemPrice: 0,
            menuItemAvailability: false
          };
        },
        mounted() {
          console.log("Page mounted ");
          console.log("Manual testing mode active ");
  
          // âœ… Start loading menu details manually
          this.fetchMenuDetails(this.menuItemID);
        },
        methods: {
          fetchMenuDetails(itemID) {
            console.log(`Loading menu item ${itemID}`);
  
            axios.get(`${menu_service_URL}/${itemID}`)
              .then(response => {
                console.log("Menu service response:", response.data);
  
                this.menuItemName = response.data.name;
                this.menuItemDescription = response.data.description;
                this.menuItemPrice = response.data.price;
                this.menuItemAvailability = response.data.availability_status;
              })
              .catch(error => {
                console.error("Menu service error ", error);
                this.feedbackError = "Error fetching menu details.";
              });
          },
          submitFeedback() {
            this.feedbackSubmitted = false;
            this.feedbackError = "";
  
            const feedbackData = {
              order_id: "manual_test_order", // You can hardcode for now
              menu_item_id: this.menuItemID,
              rating: this.rating,
              tags: this.tags ? this.tags.split(',').map(tag => tag.trim()) : [],
              description: this.description
            };
  
            console.log("Submitting feedback:", feedbackData);
  
            axios.post(submit_feedback_URL, feedbackData)
              .then(response => {
                console.log("Feedback response:", response.data);
                if (response.status === 201) {
                  this.feedbackSubmitted = true;
                  this.feedbackError = "";
                } else {
                  this.feedbackError = response.data.message || "Unexpected error.";
                }
              })
              .catch(error => {
                console.error("Feedback submission error ", error);
                this.feedbackError = "Error submitting feedback.";
              });
          }
        }
      });
  
      app.mount('#app');
    </script>
  </body>
  